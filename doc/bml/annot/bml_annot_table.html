<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of bml_annot_table</title>
  <meta name="keywords" content="bml_annot_table">
  <meta name="description" content="BML_ANNOT_TABLE transforms a table into an annotations table [internal]">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">bml</a> &gt; <a href="index.html">annot</a> &gt; bml_annot_table.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for bml/annot&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>bml_annot_table
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>BML_ANNOT_TABLE transforms a table into an annotations table [internal]</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function annot=bml_annot_table(x, description, x_var_name) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> BML_ANNOT_TABLE transforms a table into an annotations table [internal]

 Use as
   annot=bml_annot_table(x)
   annot=bml_annot_table(x, description)
   annot=bml_annot_table(x, [], x_var_name)

 x - table: should contains 'starts' and 'ends' variables
 description - string: description of the annotation table
 x_var_name - string: name of the variable used for the annot table, as
     returned by inputname(). Usefull for anidated calls.

 returns a table with variables 'id', 'starts', 'ends' and any additonal
 variable present in x. Issues a error on inconsistent input.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="bml_annot2raw.html" class="code" title="function raw = bml_annot2raw(cfg, annot)">bml_annot2raw</a>	BML_ANNOT2RAW creates a raw of zeros with ones at annot times</li><li><a href="bml_annot2spike.html" class="code" title="function spike = bml_annot2spike(cfg, annot, raw)">bml_annot2spike</a>	BML_ANNOT2SPIKE creates a ft_datatype_spike structure from an annotation table</li><li><a href="bml_annot_consolidate.html" class="code" title="function annot = bml_annot_consolidate(cfg, x)">bml_annot_consolidate</a>	BML_ANNOT_CONSOLIDATE returns a consolidated annotation table</li><li><a href="bml_annot_detect.html" class="code" title="function annot = bml_annot_detect(cfg, env)">bml_annot_detect</a>	BML_ANNOT_DETECT identifies annotations thresholding an envelope signal</li><li><a href="bml_annot_extend.html" class="code" title="function extended = bml_annot_extend(annot,ext1,ext2)">bml_annot_extend</a>	BML_ANNOT_EXTEND extends the annotation times</li><li><a href="bml_annot_filter.html" class="code" title="function filtered = bml_annot_filter(cfg, annot, filter_annot)">bml_annot_filter</a>	BML_ANNOT_FILTER returns the annots that intersect with the filter</li><li><a href="bml_annot_intersect.html" class="code" title="function annot = bml_annot_intersect(cfg, x, y)">bml_annot_intersect</a>	BML_ANNOT_INTERSECT returns the intersection of two annotation tables</li><li><a href="bml_annot_overlap.html" class="code" title="function overlap=bml_annot_overlap(cfg, annot)">bml_annot_overlap</a>	BML_ANNOT_OVERLAP calculates overlapping segments between annotations</li><li><a href="bml_annot_plot.html" class="code" title="function bml_annot_plot(cfg, annot, varargin)">bml_annot_plot</a>	BML_ANNOT_PLOT plots an annotation table</li><li><a href="bml_annot_read.html" class="code" title="function annot = bml_annot_read(filename,varargin)">bml_annot_read</a>	BML_ANNOT_READ reads an annotation table</li><li><a href="bml_annot_rowbind.html" class="code" title="function annot = bml_annot_rowbind(varargin)">bml_annot_rowbind</a>	BML_ANNOT_ROWBIND binds tables by rows, conforming to first table</li><li><a href="bml_annot_shadow.html" class="code" title="function shadow = bml_annot_shadow(cfg,annot)">bml_annot_shadow</a>	BML_ANNOT_SHADOW creates annotations that 'shadow' the ones in annot</li><li><a href="bml_annot_transfer.html" class="code" title="function transfered = bml_annot_transfer(cfg, annot, transfer)">bml_annot_transfer</a>	BML_ANNOT_TRANSFER copies information of transfer to annot</li><li><a href="bml_annot_write.html" class="code" title="function bml_annot_write(annot,filename,varargin)">bml_annot_write</a>	BML_ANNOT_WRITE writes an annotation table</li><li><a href="bml_coding2annot.html" class="code" title="function annot = bml_coding2annot(cfg)">bml_coding2annot</a>	BML_CODING2ANNOT creates annot table from CodingMatrix</li><li><a href="bml_event2annot.html" class="code" title="function annot = bml_event2annot(cfg, event)">bml_event2annot</a>	BML_EVENT2ANNOT creates a annot table from a events structure</li><li><a href="bml_plexon2annot.html" class="code" title="function [annot, spike] = bml_plexon2annot(cfg)">bml_plexon2annot</a>	BML_PLEXON2ANNOT loads spike events from plexon file</li><li><a href="bml_raw2annot.html" class="code" title="function annot = bml_raw2annot(raw)">bml_raw2annot</a>	BML_RAW2ANNOT creates an annotation table from a raw</li><li><a href="bml_roi_table.html" class="code" title="function roi=bml_roi_table(x, description, x_var_name)">bml_roi_table</a>	BML_ROI_TABLE transforms a table into an ROI table [internal]</li><li><a href="../../bml/io/bml_info_raw.html" class="code" title="function info = bml_info_raw(cfg)">bml_info_raw</a>	BML_INFO_RAW return a annot table with OS and header info of each raw file in a folder.</li><li><a href="../../bml/io/bml_load_continuous.html" class="code" title="function [raw, file_raw_map] = bml_load_continuous(cfg)">bml_load_continuous</a>	BML_LOAD_CONTINUOUS loads continuous raw from one or more files</li><li><a href="../../bml/io/bml_load_epoched.html" class="code" title="function [raw, loaded_epoch, file_raw_map] = bml_load_epoched(cfg)">bml_load_epoched</a>	BML_LOAD_EPOCHED loads an epoched raw from one or more files</li><li><a href="../../bml/io/bml_neuroomega_info_raw.html" class="code" title="function info = bml_neuroomega_info_raw(cfg)">bml_neuroomega_info_raw</a>	BML_NEUROOMEGA_INFO_RAW returns table with OS and header info of raw neuroomega.mat (.mpx) files.</li><li><a href="../../bml/signal/bml_redefinetrial.html" class="code" title="function [redefined, redefined_epoch] = bml_redefinetrial(cfg, raw)">bml_redefinetrial</a>	BML_REDEFINETRIAL creates new epoching from a raw object (not necessarily continuous)</li><li><a href="../../bml/sync/bml_chunk_sessions.html" class="code" title="function chunks = bml_chunk_sessions(session, split_time)">bml_chunk_sessions</a>	BML_CHUNK_SESSIONS breaks up sessions into smaller chunks</li><li><a href="../../bml/sync/bml_sync_analog.html" class="code" title="function sync_roi = bml_sync_analog(cfg)">bml_sync_analog</a>	BML_SYNC_ANALOG time-aligns files based on a common analog sync channel</li><li><a href="../../bml/sync/bml_sync_neuroomega_event.html" class="code" title="function sync_roi = bml_sync_neuroomega_event(cfg)">bml_sync_neuroomega_event</a>	BML_SYNC_NEUROOMEGA_EVENT synchronizes neuroomega files based on events</li><li><a href="../../bml/sync/bml_sync_transfer_neuroomega_chantype.html" class="code" title="function sync = bml_sync_transfer_neuroomega_chantype(cfg)">bml_sync_transfer_neuroomega_chantype</a>	BML_SYNC_TRANSFER_NEUROOMEGA_CHANTYPE transfer sync info from one chantype to another</li><li><a href="../../bml/sync/bml_sync_transfer_trellis_filetype.html" class="code" title="function sync = bml_sync_transfer_trellis_filetype(cfg)">bml_sync_transfer_trellis_filetype</a>	BML_SYNC_TRANSFER_TRELLIS_FILETYPE transfer sync info between trellis filetypes</li><li><a href="../../bml/sync/bml_timealign_annot.html" class="code" title="function [slave_delta_t, min_cost, warpfactor] = bml_timealign_annot(cfg, master, slave)">bml_timealign_annot</a>	BML_TIMEALIGN_ANNOT aligns slave to master and returns the slave's delta t</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function annot=bml_annot_table(x, description, x_var_name)</a>
0002 
0003 <span class="comment">% BML_ANNOT_TABLE transforms a table into an annotations table [internal]</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Use as</span>
0006 <span class="comment">%   annot=bml_annot_table(x)</span>
0007 <span class="comment">%   annot=bml_annot_table(x, description)</span>
0008 <span class="comment">%   annot=bml_annot_table(x, [], x_var_name)</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% x - table: should contains 'starts' and 'ends' variables</span>
0011 <span class="comment">% description - string: description of the annotation table</span>
0012 <span class="comment">% x_var_name - string: name of the variable used for the annot table, as</span>
0013 <span class="comment">%     returned by inputname(). Usefull for anidated calls.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% returns a table with variables 'id', 'starts', 'ends' and any additonal</span>
0016 <span class="comment">% variable present in x. Issues a error on inconsistent input.</span>
0017 
0018 <span class="keyword">if</span> isempty(x) 
0019   x=table();
0020 <span class="keyword">end</span>
0021 
0022 <span class="keyword">if</span> isnumeric(x)
0023   <span class="keyword">if</span> size(x,1) &lt; size(x,2)
0024     x = x';
0025   <span class="keyword">end</span>
0026   x = table(x);
0027 <span class="keyword">end</span>
0028 <span class="keyword">if</span> iscell(x); x=cell2table(x); <span class="keyword">end</span>
0029 <span class="keyword">if</span> isstruct(x); x=struct2table(x); <span class="keyword">end</span>
0030 
0031 <span class="keyword">if</span> ~exist(<span class="string">'description'</span>,<span class="string">'var'</span>) || isempty(description)
0032   <span class="keyword">if</span> isempty(x.Properties.Description)
0033     <span class="keyword">if</span> exist(<span class="string">'x_var_name'</span>,<span class="string">'var'</span>)
0034       description=x_var_name;
0035     <span class="keyword">else</span>
0036       description=inputname(1);
0037     <span class="keyword">end</span>
0038   <span class="keyword">else</span>
0039     description=x.Properties.Description;
0040   <span class="keyword">end</span>
0041 <span class="keyword">end</span>
0042 
0043 <span class="keyword">if</span> iscellstr(description) 
0044   <span class="keyword">if</span> numel(description)==1
0045     description = description{1};
0046   <span class="keyword">else</span>
0047     error(<span class="string">'The Description property must be a character vector.'</span>);
0048   <span class="keyword">end</span>
0049 <span class="keyword">end</span>
0050 
0051 <span class="keyword">if</span> isempty(x)
0052   annot=table();
0053   annot.Properties.Description = description;
0054   <span class="keyword">return</span>
0055 <span class="keyword">end</span>
0056 
0057 <span class="keyword">if</span> ~ismember(<span class="string">'starts'</span>,x.Properties.VariableNames)
0058   <span class="keyword">if</span> width(x)&lt;=2 
0059     x.Properties.VariableNames(1)={<span class="string">'starts'</span>};
0060   <span class="keyword">else</span>
0061     error(<span class="string">'x should have variable ''starts'''</span>);
0062   <span class="keyword">end</span>
0063 <span class="keyword">end</span>
0064 <span class="keyword">if</span>(any(ismissing(x.starts)))
0065   warning(&quot;starts contains nans&quot;);
0066 <span class="keyword">end</span>
0067 
0068 <span class="keyword">if</span> ~ismember(<span class="string">'ends'</span>,x.Properties.VariableNames)
0069   <span class="keyword">if</span> width(x)==1 
0070     x.ends = x.starts;
0071   <span class="keyword">elseif</span> width(x)==2 
0072     x.Properties.VariableNames(2)={<span class="string">'ends'</span>};
0073   <span class="keyword">else</span>
0074     error(<span class="string">'x should have variable ''ends'''</span>);
0075   <span class="keyword">end</span>  
0076 <span class="keyword">end</span>
0077 <span class="keyword">if</span>(any(ismissing(x.ends)))
0078   warning(&quot;ends contains nans&quot;);
0079 <span class="keyword">end</span>
0080 
0081 <span class="keyword">if</span> ~strcmp(<span class="string">'id'</span>,x.Properties.VariableNames)
0082   x = sortrows(x,<span class="string">'starts'</span>);
0083   x = [table(transpose(1:height(x)),<span class="string">'VariableNames'</span>,{<span class="string">'id'</span>}), x];
0084 <span class="keyword">elseif</span> length(unique(x.id)) &lt; height(x)
0085   error(<span class="string">'inconsistent id variable'</span>)
0086 <span class="keyword">else</span>
0087    x = sortrows(x,<span class="string">'id'</span>);
0088 <span class="keyword">end</span>
0089 
0090 <span class="keyword">if</span> any(strcmp(<span class="string">'duration'</span>,x.Properties.VariableNames))
0091   x.duration = [];
0092 <span class="keyword">end</span>
0093 x = [x, table(x.ends - x.starts,<span class="string">'VariableNames'</span>,{<span class="string">'duration'</span>})];
0094 
0095 annot = bml_annot_reorder_vars(x, {<span class="string">'id'</span>,<span class="string">'starts'</span>,<span class="string">'ends'</span>,<span class="string">'duration'</span>});
0096 annot.Properties.Description = description;
0097 
0098</pre></div>
<hr><address>Generated on Tue 20-Feb-2018 16:09:23 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>